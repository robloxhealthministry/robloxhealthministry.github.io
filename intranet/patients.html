<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Patients - Roblox Health Service</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../assets/css/nhsuk.min.css">
  <style>
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #d0d0d0; padding: 0.5rem; text-align: left; }
    th { cursor: pointer; background: #f7f7f7; }
    .nhsuk-button { margin-right: 0.5rem; margin-bottom: 0.25rem; }
    .badge { padding: 0.25rem 0.5rem; border-radius: 4px; color: white; font-weight: bold; }
    .Stable { background-color: green; }
    .Critical { background-color: red; }
    .Recovering { background-color: orange; }
    tr.Critical { background-color: #ffe5e5; }
    tr.Recovering { background-color: #fff3e0; }
    tr.Stable { background-color: #e5ffe5; }
  </style>
</head>
<body class="nhsuk-body nhsuk-clearfix">

<header class="nhsuk-header">
  <div class="nhsuk-width-container nhsuk-header__container">
    <span class="nhsuk-header__logo-text">Roblox Health Service</span>
  </div>
</header>

<div class="nhsuk-width-container">
  <main class="nhsuk-main-wrapper">
    <h1 class="nhsuk-heading-xl">Patient List</h1>

    <label class="nhsuk-label" for="search">Search Patients</label>
    <input class="nhsuk-input" id="search" placeholder="Search by name...">

    <table>
      <thead>
        <tr>
          <th onclick="sortTable('name')">Name</th>
          <th onclick="sortTable('room')">Room</th>
          <th onclick="sortTable('presenting')">Presenting Condition</th>
          <th onclick="sortTable('diagnosis')">Diagnosis</th>
          <th onclick="sortTable('status')">Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="patientBody"></tbody>
    </table>

    <script>
      let patients = JSON.parse(localStorage.getItem('patients') || '[]');
      let sortAsc = true;
      let currentSort = 'name';
      const tableBody = document.getElementById('patientBody');

      function savePatients() {
        localStorage.setItem('patients', JSON.stringify(patients));
        renderTable();
      }

      function renderTable(filter = '') {
        tableBody.innerHTML = '';
        patients.forEach((p, index) => {
          if (p.name.toLowerCase().includes(filter)) {
            const tr = document.createElement('tr');
            tr.className = p.status; // row highlighting
            tr.innerHTML = `
              <td>${p.name}</td>
              <td>${p.room}</td>
              <td>${p.presenting}</td>
              <td>${p.diagnosis}</td>
              <td><span class="badge ${p.status}">${p.status}</span></td>
              <td>
                <a class="nhsuk-button nhsuk-button--secondary" href="edit-patient.html?index=${index}">Edit</a>
                <a class="nhsuk-button nhsuk-button--warning" href="delete-patient.html?index=${index}">Delete</a>
              </td>
            `;
            tableBody.appendChild(tr);
          }
        });
      }

      function sortTable(column) {
        if (currentSort === column) sortAsc = !sortAsc;
        else { currentSort = column; sortAsc = true; }

        patients.sort((a,b)=>{
          if(a[column] < b[column]) return sortAsc?-1:1;
          if(a[column] > b[column]) return sortAsc?1:-1;
          return 0;
        });
        renderTable(document.getElementById('search').value.toLowerCase());
      }

      const searchInput = document.getElementById('search');
      searchInput.addEventListener('input', function() {
        renderTable(this.value.toLowerCase());
      });

      renderTable();
    </script>

  </main>
</div>

<footer class="nhsuk-footer">
  <div class="nhsuk-width-container">
    <p class="nhsuk-body-s">Â© Roblox Health Service</p>
  </div>
</footer>

</body>
</html>
